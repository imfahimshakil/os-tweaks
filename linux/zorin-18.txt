# Remove Brave Browser & Evolution Mail
sudo apt purge brave-browser brave-keyring evolution evolution-data-server evolution-common -y
sudo apt autoremove -y
sudo rm /etc/apt/sources.list.d/brave-browser-*.list
rm -rf ~/.config/BraveSoftware ~/.cache/BraveSoftware ~/.local/share/keyrings/brave-browser*
rm -rf ~/.local/share/evolution ~/.config/evolution ~/.cache/evolution ~/.config/evolution-data-server

# Nvidia Graphics Driver
# To install proprietary driver:
#   Software -> Software Repositories -> Additional Drivers
#   Select the latest version
# After reboot, make sure to select "Wayland" in login screen.

# Delete Obsolete EFI
# List the Boot IDs to delete based on manual inspection.
# Example -> ("0000" "0002")
sudo efibootmgr -v
sudo efibootmgr -b 0000 -B
sudo efibootmgr -b 0002 -B
# Mount EFI Partion 
sudo mount "$(df /boot/efi | awk 'NR==2 {print $1}')" /mnt
# Identify previous OS efi
# Example -> ("debian" "Microsoft")
sudo ls /mnt/EFI
sudo rm -rf /mnt/EFI/debian
sudo umount /mnt

# Firefox
sudo apt install firefox -y
# Disbale ffmpeg decode to stop stuttering
# Firefox address bar -> about:config -> media.ffmpeg.enabled -> false
#########
# Enabling Hardware Decode (Optional)
sudo add-apt-repository ppa:ubuntuhandbook1/nvidia-vaapi -y
sudo apt update && sudo apt install nvidia-vaapi-driver vainfo -y
grep -qxF "export LIBVA_DRIVER_NAME=nvidia" ~/.profile || sed -i '$ a export LIBVA_DRIVER_NAME=nvidia\nexport MOZ_DISABLE_RDD_SANDBOX=1\nexport NVD_BACKEND=direct' ~/.profile
# Firefox address bar:
# about:config -> media.hardware-video-decoding.force-enabled  -> true
# about:config -> media.ffmpeg.enabled  -> true
# about:config -> media.rdd-ffmpeg.enabled  -> true
# about:config -> gfx.x11-egl.force-enabled  -> true
# about:config -> widget.dmabuf.force-enabled  -> true

# Bitwarden
flatpak install flathub com.bitwarden.desktop -y

# Proton VPN
flatpak install flathub com.protonvpn.www -y

# TCP BBR
echo -e "net.core.default_qdisc=fq\nnet.ipv4.tcp_congestion_control=bbr" | sudo tee -a /etc/sysctl.conf && sudo /usr/sbin/sysctl -p

# UNRAR
sudo apt install unrar -y

# BleachBit
sudo apt install bleachbit -y

# Flameshot
sudo apt install flameshot xdotool -y
# Add custom shortcut
#   Settings -> Keyboard -> View  and Customizable Shortcuts
#   Custom Shortcuts -> +
#      Name: Flameshot, Command: xdotool exec flameshot gui
#      Shortcut: Ctrl + Alt + P

# Ulauncher
sudo add-apt-repository ppa:agornostal/ulauncher -y
sudo apt update && sudo apt install ulauncher -y
# Hotkey In Wayland
#   Settings -> Keyboard -> View  and Customizable Shortcuts
#   Custom Shortcuts -> +
#      Name: Ulauncher, Command: ulauncher-toggle
#      Shortcut: Ctrl + Space

# Extension Manager
flatpak install flathub com.mattjakeman.ExtensionManager -y

# OBS Studio
flatpak install flathub com.obsproject.Studio -y

# JetBrain Rider
sudo snap install rider --classic

# Fastfetch
sudo add-apt-repository ppa:zhangsongcui3371/fastfetch -y && sudo apt update
sudo apt install fastfetch -y

# Codecs & Fonts (Requires local files: ttf-ms-win10/*.{ttf,ttc})
# sudo apt install zorin-os-restricted-extras -y
sudo apt install gstreamer1.0-libav -y
sudo mkdir -p /usr/local/share/fonts/ms-win10
# Download microsoft fonts and place it under os-tweaks/linux folder
# https://mega.nz/file/FIQl0YYI#iVrhLRYwqUR4YV7i9Z5o2QHj0HVlb4wUOmTLEetyDs8
tar xf ms-fonts.tar.xz
sudo cp ms-fonts/*.{ttf,ttc} /usr/local/share/fonts/ms-win10/
rm -rf ms-fonts*
fc-cache -fv

# Avro Phonetic (Bangla Input)
sudo apt install ibus-avro -y
# Add input method in Settings: Keyboard -> Add Input Source -> â‹® -> avro -> Bangla -> Avro Phonetic -> Add

# Timeshift
sudo apt install timeshift -y

# Aria2
sudo apt install aria2 -y

# OpenVPN (Network Manager Integration)
# To disable IPv6 in VPN settings:
#   ipv6 settings -> manual
#   addresses -> Address: 2000:: Prefix: 3 Gateway: 0100::1
#   dns servers -> 2001:db8:dead:beef::1

# MPV Player
sudo wget -P /etc/apt/trusted.gpg.d https://apt.fruit.je/fruit.gpg
echo "deb http://apt.fruit.je/ubuntu noble mpv" | sudo tee -a /etc/apt/sources.list.d/fruit.list
sudo apt update && sudo apt install mpv -y
sudo rm -rf /etc/mpv
sudo cp -r mpv-config /etc/mpv
sudo sed -i "s|^hwdec=.*|hwdec=$( (vainfo >/dev/null 2>&1 && echo vaapi-copy) || (vdpauinfo >/dev/null 2>&1 && echo vdpau-copy) || echo no )|" /etc/mpv/mpv.conf

# YT-DLP
sudo add-apt-repository ppa:tomtomtom/yt-dlp -y && sudo apt update
sudo apt install yt-dlp -y

# Media Tools
sudo add-apt-repository ppa:ubuntuhandbook1/vlc -y && sudo apt update
sudo apt install mkvtoolnix-gui mediainfo-gui kid3 vlc -y

# IPTVnator (Installation from GitHub)
read -p "Download (1) stable or (2) beta? " choice
url=$(wget -qO- "https://api.github.com/repos/4gray/iptvnator/releases$( [ "$choice" != "2" ] && echo "/latest")" | grep -m1 "browser_download_url.*deb" | cut -d'"' -f4)
wget --content-disposition "$url" && sudo apt install ./iptvnator*.deb -y && rm -rf iptvnator*.deb

# MergerFS (Combining Drives)
sudo apt install mergerfs -y
sudo mkdir -p /mnt/library /mnt/data1 /mnt/data2 /mnt/data3

# Execute these commands one-by-one to configure MergerFS:
sda1=$(sudo blkid -s UUID -o value /dev/sda1)
sdb1=$(sudo blkid -s UUID -o value /dev/sdb1)
sdc1=$(sudo blkid -s UUID -o value /dev/sdc1)
set=defaults,noatime,nodiratime,commit=5,data=ordered
echo -e "\nUUID=$sda1\t/mnt/data1\text4\t$set\t0\t2\nUUID=$sdb1\t/mnt/data2\text4\t$set\t0\t2\nUUID=$sdc1\t/mnt/data3\text4\t$set\t0\t2" | sudo tee -a /etc/fstab
echo -e "\n/mnt/data1/media:/mnt/data2/media:/mnt/data3/media /mnt/library fuse.mergerfs ro,allow_other,use_ino 0 0" | sudo tee -a /etc/fstab
unset u; PS3="Select a user: "; select u in $(ls /home); do [[ -n $u ]] && sudo chown -R root:$(id -gn $u) /mnt/library && break; done
sudo systemctl daemon-reload && sudo mount -a

# HDD Tuning (Requires local files: hdd-tune.sh, hdd-tuning.service)
sudo cp hdd/hdd-tune.sh /usr/local/sbin/
sudo chmod +x /usr/local/sbin/hdd-tune.sh
sudo cp hdd/hdd-tuning.service /etc/systemd/system/hdd-tuning.service
sudo systemctl daemon-reload
sudo systemctl enable hdd-tuning.service && sudo systemctl start hdd-tuning.service

# Samba
sudo apt install samba apparmor-utils -y
# Turn AppArmor off
# sudo aa-complain /usr/sbin/smbd && sudo systemctl reload apparmor
unset u; PS3="Select a user: "; select u in $(ls /home); do [[ -n "$u" ]] && break; done
sudo smbpasswd -a $u && sudo smbpasswd -e $u
mkdir -p ~/.samba && ln -s /mnt/data{1,2,3} ~/.samba/
sudo cp hdd/smb.conf /etc/samba/
sudo sed -i "s/valid users = .*/valid users = $u/" /etc/samba/smb.conf
sudo sed -i "s/path = .*/path = \/home\/$u\/.samba/" /etc/samba/smb.conf
sudo systemctl restart smbd && sudo systemctl enable smbd

# Git & Git Credential Manager
sudo apt install git -y
url=$(wget -qO- "https://api.github.com/repos/git-ecosystem/git-credential-manager/releases/latest" | grep -m1 "browser_download_url.*gcm-linux_amd64.*\.deb" | cut -d'"' -f4)
wget --content-disposition "$url" && sudo apt install ./gcm*.deb && rm -rf gcm*.deb
git-credential-manager configure

# NGINX
sudo apt install nginx apache2-utils -y
# sudo htpasswd -c /etc/htpasswd $(whoami)
sudo mkdir -p /etc/nginx/apps/
sudo cp nginx/ssl-params.conf /etc/nginx/snippets/
sudo cp nginx/nginx-proxy.conf /etc/nginx/snippets/proxy.conf
sudo rm -rf /etc/nginx/sites-enabled/default
sudo cp nginx/nginx.conf /etc/nginx/sites-enabled/default
# Domain (Optional)
sudo -i
read -rp "Hostname: " hostname && sed -i "s/server_name .*/server_name $hostname;/g" /etc/nginx/sites-enabled/default
sudo mkdir -p /etc/nginx/ssl/${hostname}
sudo chmod 700 /etc/nginx/ssl
curl https://get.acme.sh | sh
/root/.acme.sh/acme.sh --set-default-ca --server zerossl
read -rp "Email: " email && /root/.acme.sh/acme.sh  --register-account  -m ${email}
/root/.acme.sh/acme.sh --force --issue --nginx -d ${hostname}
/root/.acme.sh/acme.sh --force --install-cert -d ${hostname} --key-file /etc/nginx/ssl/${hostname}/key.pem --fullchain-file /etc/nginx/ssl/${hostname}/fullchain.pem --ca-file /etc/nginx/ssl/${hostname}/chain.pem --reloadcmd "systemctl reload nginx"
sed -i "s/ssl_certificate .*/ssl_certificate \/etc\/nginx\/ssl\/${hostname}\/fullchain.pem;/g" /etc/nginx/sites-enabled/default
sed -i "s/ssl_certificate_key .*/ssl_certificate_key \/etc\/nginx\/ssl\/${hostname}\/key.pem;/g" /etc/nginx/sites-enabled/default
systemctl reload nginx
exit

# qBittorent
############
# Option A (build)
sudo apt install build-essential pkg-config automake libtool qtbase5-dev qttools5-dev qttools5-dev-tools libssl-dev zlib1g-dev libboost-system-dev libboost-dev -y
wget https://github.com/arvidn/libtorrent/releases/download/v1.2.15/libtorrent-rasterbar-1.2.15.tar.gz
tar xf libtorrent-rasterbar-1.2.15.tar.gz && cd libtorrent-rasterbar-1.2.15
./configure --disable-debug -enable-encryption --enable-python-binding=no --with-boost-python=none
make -j$(nproc)
sudo make install && sudo ldconfig && cd ..
wget https://github.com/qbittorrent/qBittorrent/archive/refs/tags/release-4.3.9.tar.gz
tar xf release-4.3.9.tar.gz && cd qBittorrent-release-4.3.9
./configure --disable-gui
make -j$(nproc)
sudo make install && cd ..
rm -rf libtorrent-rasterbar-* qBittorrent-release-* release-*
############
# Option B (qbittorrent-nox-static)
mkdir -p ~/bin && cd ~/bin
wget 'https://github.com/userdocs/qbittorrent-nox-static/releases/download/release-5.1.4_v2.0.11/x86_64-qbittorrent-nox' -O qbittorrent-nox
chmod +x qbittorrent-nox
############
# Modifying config
sudo cp qbittorrent/qbittorrent@.service /etc/systemd/system/
rm -rf ~/.config/qBittorrent/qBittorrent.conf
mkdir -p ~/.config/qBittorrent
cp qbittorrent/qBittorrent.conf ~/.config/qBittorrent/
hashed=$(read -s -p "Password: " password && python3 qbittorrent.Userpass.py "$password") && echo
QBTWP="WebUI\\\\Password_PBKDF2=\"@ByteArray($hashed)\""
sed -i "s/^WebUI\\\\Username=.*/WebUI\\\\Username=$(whoami)/" ~/.config/qBittorrent/qBittorrent.conf
sed -i "s|^Downloads\\\\SavePath=.*|Downloads\\\\SavePath=$HOME/Downloads|" ~/.config/qBittorrent/qBittorrent.conf
sed -i "/^QBTWP/c\\\\${QBTWP}" ~/.config/qBittorrent/qBittorrent.conf
# Enable systemd start
sudo cp qbittorrent/qbittorrent-start.sh /usr/local/bin/
sudo chmod +x /usr/local/bin/qbittorrent-start.sh
sudo cp qbittorrent/qbittorrent@.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable --now qbittorrent@$(whoami)
# Nginx Setup
port=$(grep 'WebUI\\Port' ~/.config/qBittorrent/qBittorrent.conf | cut -d= -f2)
sudo cp qbittorrent/qbt.conf /etc/nginx/apps/qbittorrent.conf
sudo sed -i "s/127.0.0.1:port/127.0.0.1:${port}/" /etc/nginx/apps/qbittorrent.conf
sudo systemctl reload nginx

# File Browser
curl -fsSL https://raw.githubusercontent.com/filebrowser/get/master/get.sh | bash
mkdir -p ~/.config/filebrowser
cp web-file-browser/filebrowser-settings.json ~/.config/filebrowser/settings.json
sed -i "s|\"database\": \"\"|\"database\": \"/home/$(whoami)/.config/filebrowser/database.db\"|" ~/.config/filebrowser/settings.json
# Nginx Setup
sudo cp web-file-browser/filebrowser.conf /etc/nginx/apps/
port=$(grep '"port"' ~/.config/filebrowser/settings.json | cut -d: -f2 | tr -d ' ,') && sudo sed -i "s|http://127.0.0.1:port/filebrowser|http://127.0.0.1:${port}/filebrowser|g" /etc/nginx/apps/filebrowser.conf
sudo systemctl reload nginx
# Enable systemd start
sudo cp web-file-browser/filebrowser.service /etc/systemd/system/
sudo sed -i "s|\who|$(whoami)|g" /etc/systemd/system/filebrowser.service
sudo systemctl daemon-reload && sudo systemctl enable -q --now filebrowser.service
# Set User Account
sudo systemctl stop filebrowser
read -s -p "Password: " password && filebrowser users add "$(whoami)" "$password" --perm.admin -d "/home/$(whoami)/.config/filebrowser/database.db"
sudo systemctl start filebrowser

# Terminal Modification
# https://starship.rs/
# https://forum.zorin.com/t/bash-customization-on-zorin/41470/4
# https://www.nerdfonts.com/cheat-sheet

# Taskbar Modification
# https://extensions.gnome.org/extension/6655/openweather/
# https://extensions.gnome.org/extension/1460/vitals/
# https://extensions.gnome.org/extension/3193/blur-my-shell/
