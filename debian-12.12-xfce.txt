======================================
DEBIAN SYSTEM SETUP GUIDE (BOOKWORM)
======================================

1. FIX AND UPDATE REPOSITORY CONFIGURATION
-----------------------------------------
# Uncomment any lines starting with 'deb cdrom:'
sed -i '/^deb cdrom:/s/^/# /' /etc/apt/sources.list

# Enable contrib, non-free, and non-free-firmware for the bookworm repositories
sed -i '/^deb\(-src\)\? .*bookworm/ s/\(deb\(-src\)\? .*bookworm.*main\)\(.*\)$/\1 contrib non-free non-free-firmware/' /etc/apt/sources.list

# Add bookworm-backports repository with contrib/non-free components
echo -e "\n# Debian Backports Repository\ndeb http://deb.debian.org/debian bookworm-backports main contrib non-free non-free-firmware\ndeb-src http://deb.debian.org/debian bookworm-backports main contrib non-free non-free-firmware" | tee -a /etc/apt/sources.list

# Update the package lists
apt update

2. BASIC UTILITY AND CONNECTIVITY
---------------------------------
# Bluetooth
apt install bluetooth blueman firmware-realtek -y
reboot

# LightDM GTK Greeter
apt install lightdm-gtk-greeter-settings -y

# BleachBit
apt install bleachbit -y

# Screenfetch
apt install screenfetch -y

# Aria2
apt install aria2 -y

# OpenVPN (Network Manager Integration)
apt install network-manager-openvpn-gnome -y
# To disable IPv6 in VPN settings:
#   ipv6 settings -> addresses only
#   static addresses -> Address: 2000:: Prefix: 3 Gateway: 0100::1
#   dns servers -> ::

# Speedtest
wget --content-disposition "https://install.speedtest.net/app/cli/ookla-speedtest-1.2.0-linux-x86_64.tgz"
tar xvzf ookla-speedtest-1.2.0-linux-x86_64.tgz --wildcards 'speedtest'
mv speedtest /usr/local/bin/
rm -rf ookla-speedtest-1.2.0-linux-x86_64.tgz

3. DRIVERS AND MULTIMEDIA
-------------------------
# Nvidia Graphics Driver
apt install nvidia-driver -y

# Codecs & Fonts
apt install ttf-mscorefonts-installer rar unrar libavcodec-extra gstreamer1.0-vaapi -y

# Install MS Windows 10 Fonts (Requires local files: ttf-ms-win10/*.{ttf,ttc})
mkdir -p /usr/local/share/fonts/ms-win10
cp ttf-microsoft/*.{ttf,ttc} /usr/local/share/fonts/ms-win10/
fc-cache -fv

# Avro Phonetic (Bangla Input)
apt install ibus-avro -y
# Add input method in IBus Preferences: Input Method -> Add -> avro -> Bangla -> Avro Phonetic -> Add

4. MEDIA AND DISK MANAGEMENT TOOLS
----------------------------------
# MPV Player
wget -P /etc/apt/trusted.gpg.d https://apt.fruit.je/fruit.gpg
echo "deb http://apt.fruit.je/debian bookworm mpv" | tee -a /etc/apt/sources.list.d/fruit.list
apt install mpv -y
rm -rf /etc/mpv
cp -r mpv /etc/

# YT-DLP
apt -t bookworm-backports install yt-dlp -y

# IPTVnator (Installation from GitHub)
read -p "Download (1) stable or (2) beta? " choice
url=$(wget -qO- "https://api.github.com/repos/4gray/iptvnator/releases$( [ "$choice" != "2" ] && echo "/latest")" | grep -m1 "browser_download_url.*deb" | cut -d'"' -f4)
wget --content-disposition "$url"
apt install ./iptvnator*.deb -y
rm -rf iptvnator*.deb

# Media Tools
apt install mkvtoolnix-gui mediainfo-gui easytag ffmpeg vlc -y

# Screen Recording
apt install simplescreenrecorder -y

# Partitioning
apt install gparted -y

# Smartmontools
apt install smartmontools -y

5. ADVANCED FILE MANAGEMENT
---------------------------
# MergerFS (Combining Drives)
apt install mergerfs -y
mkdir -p /mnt/library /mnt/data1 /mnt/data2 /mnt/data3

# Execute these commands one-by-one to configure MergerFS:
sda1=$(blkid -s UUID -o value /dev/sda1)
sdb1=$(blkid -s UUID -o value /dev/sdb1)
sdc1=$(blkid -s UUID -o value /dev/sdc1)
set=defaults,noatime,nodiratime,commit=5,data=ordered
echo -e "\nUUID=$sda1\t/mnt/data1\text4\t$set\t0\t2\nUUID=$sdb1\t/mnt/data2\text4\t$set\t0\t2\nUUID=$sdc1\t/mnt/data3\text4\t$set\t0\t2" | tee -a /etc/fstab
echo -e "\n/mnt/data1/media:/mnt/data2/media:/mnt/data3/media /mnt/library fuse.mergerfs ro,allow_other,use_ino 0 0" | tee -a /etc/fstab
unset u; PS3="Select a user: "; select u in $(ls /home); do [[ -n $u ]] && chown -R root:$(id -gn $u) /mnt/library && break; done
systemctl daemon-reload
mount -a

# HDD Tuning (Requires local files: hdd-tune.sh, hdd-tuning.service)
cp hdd-tune.sh /usr/local/sbin/
chmod +x /usr/local/sbin/hdd-tune.sh
cp hdd-tuning.service /etc/systemd/system/hdd-tuning.service
systemctl daemon-reload
systemctl enable hdd-tuning.service
systemctl start hdd-tuning.service

# GVFS
apt install gvfs-backends gvfs-fuse -y

# Samba
apt install samba -y
unset u; PS3="Select a user: "; select u in $(ls /home); do [[ -n "$u" ]] && break; done
smbpasswd -a $u && smbpasswd -e $u
cp smb.conf /etc/samba/
sed -i "s/valid users = .*/valid users = $u/" /etc/samba/smb.conf
systemctl restart smbd
systemctl enable smbd

6. DEVELOPMENT AND USER MANAGEMENT
----------------------------------
# Git & Git Credential Manager
apt install git -y
url=$(wget -qO- "https://api.github.com/repos/git-ecosystem/git-credential-manager/releases/latest" | grep -m1 "browser_download_url.*gcm-linux_amd64.*\.deb" | cut -d'"' -f4)
wget --content-disposition "$url"
apt install ./gcm*.deb
rm -rf gcm*.deb
git-credential-manager configure

# Sublime Text
wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | tee /etc/apt/keyrings/sublimehq-pub.asc > /dev/null
echo -e 'Types: deb\nURIs: https://download.sublimetext.com/\nSuites: apt/stable/\nSigned-By: /etc/apt/keyrings/sublimehq-pub.asc' | tee /etc/apt/sources.list.d/sublime-text.sources
apt update
apt install sublime-text -y

# Mugshot (Whisker Menu)
apt install mugshot -y

# Swizzin (Server/Seedbox Stack)
bash <(wget -qO - s5n.sh) && . ~/.bashrc
# Note: If you select an existing user, you might need to reset their password:
# passwd enten

# Change Filebrowser's Root Directory to /mnt/library
unset u; PS3="Select a user: "; select u in $(ls /home); do [[ -n "$u" ]] && break; done
/home/$u/bin/filebrowser config set -r /mnt/library -d /home/$u/.config/Filebrowser/filebrowser.db

# Change rTorrent port into static
unset u; PS3="Select a user: "; select u in $(ls /home); do [[ -n "$u" ]] && break; done; read -p "Select a port (e.g., 50000): " p; sed -i -e '/^network.port_random.set = yes/c\network.port_random.set = no' -e "s/^network.port_range.set = [0-9]\{4,6\}-[0-9]\{4,6\}/network.port_range.set = $p-$p/" "/home/$u/.rtorrent.rc"

# Change ruTorrent Top Directory to '/'
sed -i "s|^\(\$topDirectory = \)'[^']*';|\1'/';|" "/srv/rutorrent/conf/users/$u/config.php"

# Swizzin grants the chosen master account (e.g., enten) sudo privileges.
# To remove sudo access manually (Note: Red dots may appear in Service Info even when services are normal.):
# gpasswd -d enten sudo

# Fix Swizzin panel alongside granting sudo to master user:
# box upgrade panel

7. COMMUNICATION TOOLS
----------------------
# Mailspring
wget --content-disposition "https://updates.getmailspring.com/download?platform=linuxDeb"
apt install ./mailspring*.deb -y
rm -rf mailspring*.deb

# Discord
wget --content-disposition "https://discord.com/api/download?platform=linux&format=deb"
apt install ./discord*.deb -y
rm -rf discord*.deb
# To make discord autostart minimized:
# Session and Startup -> Add:
#   Name -> Discord
#   Command -> /usr/share/discord/Discord --start-minimized

# Telegram
wget --content-disposition "https://telegram.org/dl/desktop/linux"
tar xf tsetup*.xz
mv Telegram/Telegram /usr/local/bin/
rm -rf tsetup*.xz Telegram
# To make telegram autostart minimized:
# Session and Startup -> Add:
#   Name -> Telegram
#   Command -> /usr/local/bin/Telegram -autostart